<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      options: {
        renderActions: {
          addMenu: []
        }
      },
      svg: {
        fontCache: 'global',
        scale: 1.0
      }
    };
    document.addEventListener("DOMContentLoaded", () => {
    const sidebar = document.querySelector('.sidebar');
    const main = document.querySelector('.main-content');
    const wrapper = document.createElement('div');
    wrapper.className = 'layout';

    sidebar.parentNode.insertBefore(wrapper, sidebar);
    wrapper.appendChild(sidebar);
    wrapper.appendChild(main);
  });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>

</head>
<body>
  <div class="sidebar">
    <img src="Logo_NS-blackboard-Expand.png" alt="Sidebar Image">
    <nav>
      <ul class="nav-menu">
        <li><a href="Welcome.html">Welcome to NFYK22003U</a></li>
        <li><a href="CourseInformation.html">Course Information</a></li>
        <li><a href="Schedule2025.html">Schedule 2025</a></li>
        <li><a href="MathsSpeedrun.html">Maths Speedrun</a></li>
        <li>
          <a href="Lecture1.html">Lecture 1</a></li>
          <ul class="sub-menu">
            <li><a href="Project1.html">Project 1 – Oxygen Budget</a></li>
          </ul>
          <li><a href="Lecture2.html">Lecture 2</a></li>
          <ul class="sub-menu">
            <li><a href="Project2.html">Project 2 – The Sverdrup Relation</a></li>
          </ul>
          <li><a href="Lecture3.html">Lecture 3</a></li>
          <li><a href="Lecture4.html">Lecture 4</a></li>
          <ul class="sub-menu">
            <li><a href="Project3.html">Project 3 – Western Boundary Currents</a></li>
          </ul>
          <li><a href="Lecture5.html">Lecture 5</a></li>
          <li><a href="Lecture6.html">Lecture 6</a></li>
          <li><a href="Lecture7.html">Lecture 7</a></li>
          <ul class="sub-menu">
            <li><a href="Project4.html">Project 4 – Shadow Zone</a></li>
          </ul>
          <li><a href="Lecture8.html">Lecture 8</a></li>
          <li><a href="Lecture9.html">Lecture 9</a></li>
          <ul class="sub-menu">
            <li><a href="Project5.html">Project 5 – Hadley Cell</a></li>
          </ul>
          <li><a href="References.html">References</a></li>
        </li>
      </ul>
    </nav>
  </div>

  <div class="main-content">
<h1>Project 5 – Hadley Cell</h1>
<div style="border: 2px solid #17a2b8; background-color: #d1ecf1; padding: 20px; border-radius: 5px;">
  <h1 style="color: blue;">Homework 5: Testing Hadley Cell Width Theory in an Atmospheric Climate Model</h1>
  <hr style="border: 1px solid #17a2b8;">     
  <p style="font-size: 20px; color: #FF69B4;">
    This week we will test the theory of Hadley Cell Width in the Speedy Aquaplanet Model
  </p>
  <hr style="border: 1px solid #17a2b8;">
</div>

The model we are using is called pySPEEDY, the documentation can be found at: <a href="https://pyspeedy.readthedocs.io/en/latest/user_guide.html">pySPEEDY user guide</a><br>

<strong>Note:</strong> You need to install pySPEEDY-aqua each time we use an erda session, or if you manage to run it locally on your laptop or home computer, then only once.<br>

<strong>In terminal:</strong><br>
<span class="bullet"></span>1. Create the environment with Python 3.9 and core tools<br>
    <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">conda create -n pyspeedy python=3.9 pip numpy=1.23 setuptools=59.5 -y</code></pre>
    </div>

<span class="bullet"></span>2. Activate the environment<br>
    <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">conda activate pyspeedy</code></pre>
    </div>

<span class="bullet"></span>3. Install dependencies<br>
    <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">pip install jinja2 ipykernel</code></pre>
    </div>

<span class="bullet"></span>4. Install pySPEEDY-aqua from GitHub<br>
    <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">pip install git+https://github.com/guidov/pySPEEDY-aqua.git</code></pre>
    </div>

<span class="bullet"></span>5. Register the Jupyter kernel<br>
    <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">python -m ipykernel install --user --name pyspeedy --display-name "Python (pyspeedy)"</code></pre>
    </div>

  Now you can start your notebook with <code>Python (pyspeedy)</code> kernal (you may need to wait a few minutes)<br>

  <h2>Load modules that we will use for this project:</h2>
      <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">!which python
!python -V

import pyspeedyaqua</code></pre>
    </div>
    <pre style="font-family: 'Courier New', Courier, monospace; color: #aaccee; background: transparent; border: none; padding: 1em 0; margin: 0;">
/opt/conda/bin/python
Python 3.12.7
</pre>

      <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">import pyspeedyaqua

print("pyspeedyaqua imported successfully!")
print(dir(pyspeedyaqua))  # Show available submodules/functions</code></pre>
    </div>

          <div class="code-block">
      <button class="copy-btn" onclick="copyToClipboard(this)">Copy</button>
      <pre><code class="language-python">pip show pyspeedyaqua</code></pre>
    </div>

<img src="Figures/Project5_AtmosphericCirculation.png" alt="AtmosphericCirculation" style="margin-top: 1.5em; max-width: 100%; display: block;">      
    <div class="figure-caption">(Schematic illustration of dynamical processes occurring on a generic terrestrial exoplanet. These include baroclinic eddies, Rossby waves, and eddy-driven jet streams in the extratropics, and Hadley circulations, large-scale Kelvin
and Rossby waves, and (in some cases) equatorial superrotation in the tropics. The “X” at the equator marks the substellar
point, which will be fixed in longitude on synchronously rotating planets. Cloud formation, while complex, will likely
be preferred in regions of mean ascent, including the rising branch of the Hadley circulation, within baroclinic eddies,
and—on synchronously rotating planets—in regions of ascent on the dayside.
      Credit: Showman, Adam P., Robin D. Wordsworth, Timothy M. Merlis, and Yohai Kaspi. 2013.
"Atmospheric Circulation of Terrestrial Exoplanets." Pre-print.)</div>     

<p>Let’s start from the general continuity equation for incompressible flow, and work step-by-step to arrive at the zonal mean continuity equation in pressure coordinates and finally the streamfunction used for meridional overturning circulation in the atmosphere.</p>

<h3>General Continuity Equation for Incompressible Flow</h3>
$$
\nabla \cdot \mathbf{u} = 
\underbrace{\frac{\partial u}{\partial x}}_{\text{$u$: zonal (east-west) velocity}} +
\underbrace{\frac{\partial v}{\partial y}}_{\text{$v$: meridional (north-south) velocity}} +
\underbrace{\frac{\partial w}{\partial z}}_{\text{$w$: vertical velocity (in height coordinates $z$)}} = 0
$$

<h3>Zonal Averaging</h3>
We average over the longitude (x) to get the zonal-mean equation.

$$
\left[ \frac{\partial u}{\partial x} \right] + \frac{\partial \left[ v \right]}{\partial y} + \frac{\partial \left[ w \right]}{\partial z} = 0
$$

But by definition of the zonal average:

$$
\left[ \frac{\partial u}{\partial x} \right] = \frac{\partial \left[ u \right]}{\partial x} = 0 \quad \text{(since } [u] \text{ is zonally averaged)}
$$

So the zonal mean continuity equation becomes:

$$
\frac{\partial \left[ v \right]}{\partial y} + \frac{\partial \left[ w \right]}{\partial z} = 0
$$

This is the mass continuity equation in the meridional plane (y-z)

<h3>Transform to Spherical Coordinates</h3>
Let’s now switch to spherical coordinates:<br>

 $\varphi$: latitude <br>
 $a$: Earth radius<br>
 $y = a \varphi \Rightarrow \partial y = a \, d\varphi$
<img src="Figures/Project5_SphericalCoordinates.png" alt="SphericalCoordinates" style="margin-top: 1.5em; max-width: 100%; display: block;">      

Then, the horizontal divergence becomes:

$$
\frac{\partial \left[ v \right]}{\partial y} \to \frac{1}{a \cos \varphi} \frac{\partial \left( \left[ v \right] \cos \varphi \right)}{\partial \varphi}
$$

So the spherical form of the zonal-mean continuity equation in height coordinates is:

$$
\frac{1}{a \cos \varphi} \frac{\partial \left( \left[ v \right] \cos \varphi \right)}{\partial \varphi} + \frac{\partial \left[ w \right]}{\partial z} = 0
$$

<h3>Switch to Pressure Coordinates</h3>
The hydrostatic equation (which is an excellent approximation in large-scale atmospheric flow) states:

$$
\underbrace{dp}_{\substack{\text{change in} \\ \text{pressure (Pa)}}}
=
-\, \underbrace{\rho}_{\substack{\text{air density} \\ \text{(kg/m$^3$)}}} \,
\underbrace{g}_{\substack{\text{gravitational acceleration}}}\,
\underbrace{dz}_{\substack{\text{change in height (m)}}}
$$

A derivative with respect to height is proportional to a negative derivative with respect to pressure.
This can also be written in differential form as:

$$
dp = -\rho g \, dz
$$

The goal is to express $\frac{\partial}{\partial z}$ in terms of $\frac{\partial}{\partial p}$

We want to rewrite vertical derivatives like $\frac{\partial \overline{w}}{\partial z}$ in terms of $\frac{\partial}{\partial p}$, using the relationship $dp = -\rho g \, dz$.

First, solve for $dz$:

$$
dz = -\frac{1}{\rho g} \, dp
$$

Apply the chain rule to change derivatives from $z$ to $p$:

$$
\frac{\partial}{\partial z} = \frac{dp}{dz} \cdot \frac{\partial}{\partial p} = -\rho g \cdot \frac{\partial}{\partial p}
$$

$$
\therefore \boxed{
\frac{\partial}{\partial z} = -\rho g \, \frac{\partial}{\partial p}
}
$$

Then, the vertical velocity in pressure coordinates is defined as:

$$
\omega = \frac{dp}{dt} \quad \text{(units: Pa/s)}
$$

In height coordinates, vertical velocity is:

$$
w = \frac{dz}{dt} \quad \text{(units: m/s)}
$$


Differentiate both sides of:

$$
dp = -\rho g \, dz
$$

with respect to time $t$:

$$
\frac{dp}{dt} = -\rho g \cdot \frac{dz}{dt}
$$

Now rearrange:

$$
\frac{dz}{dt} = -\frac{1}{\rho g} \cdot \frac{dp}{dt}
\Rightarrow
w = -\frac{\omega}{\rho g}
$$

Thus:

$$
\boxed{
w = \frac{dz}{dt} = -\frac{\omega}{\rho g}
}
$$

The continuity equation in pressure coordinates becomes:

$$
\frac{1}{a \cos \varphi} \frac{\partial \left( \left[ \overline{v} \right] \cos \varphi \right)}{\partial \varphi} + \frac{\partial \left[ \overline{\omega} \right]}{\partial p} = 0
$$

<h3>Define the Streamfunction $\Psi(\varphi, p)$</h3>
For 2D incompressible flow in Cartesian coordinates $(y, z)$, the continuity equation is:

$$
\frac{\partial v}{\partial y} + \frac{\partial w}{\partial z} = 0
$$

We can define a streamfunction $\psi(y, z)$ such that this equation is automatically satisfied by:

$$
v = \frac{\partial \psi}{\partial z}, \quad
w = -\frac{\partial \psi}{\partial y}
$$

Why does this work?

Plug these into the continuity equation:

$$
\frac{\partial v}{\partial y} + \frac{\partial w}{\partial z}
= \frac{\partial^2 \psi}{\partial y \partial z}
- \frac{\partial^2 \psi}{\partial z \partial y} = 0
$$

These definitions automatically conserve mass.

We now convert to spherical coordinates (latitude and pressure):<br>

$y \rightarrow \varphi$ (latitude), using $y = a \varphi$<br>
$z \rightarrow p$ (pressure, via hydrostatic relation)<br>


$$
\left[ \overline{v} \right] = \frac{g}{2\pi a \cos \varphi} \frac{\partial \Psi}{\partial p}
\quad \text{(meridional velocity)}
$$

$$
\left[ \overline{\omega} \right] = -\frac{g}{2\pi a^2 \cos \varphi} \frac{\partial \Psi}{\partial \varphi}
\quad \text{(vertical pressure velocity)}
$$


<h3>Compute $\Psi(\varphi, p)$ from \([\overline{v}]\)</h3>
Given:

$$
\boxed{
\overline{v} = \frac{g}{2\pi a \cos\varphi} \frac{\partial \Psi}{\partial p}
}
$$

This means that $\overline{v}$ is the partial derivative of $\Psi$ with respect to $p$, up to a known constant.

Multiply both sides by $\frac{2\pi a \cos\varphi}{g}$:

$$
\frac{\partial \Psi}{\partial p} = \frac{2\pi a \cos\varphi}{g} \cdot \overline{v}(\varphi, p) 
$$

Now integrate from a reference pressure level $p_{\text{top}}$ to a level $p$:

$$
\int_{p_{\text{top}}}^{p} \frac{\partial \Psi}{\partial p'} \, dp'
=
\int_{p_{\text{top}}}^{p} \frac{2\pi a \cos\varphi}{g} \cdot \overline{v}(\varphi, p') \, dp'
$$

The left-hand side is just $\Psi(\varphi, p) - \Psi(\varphi, p_{\text{top}})$. So:

$$
\Psi(\varphi, p) - \Psi(\varphi, p_{\text{top}})
= \frac{2\pi a \cos\varphi}{g} \int_{p_{\text{top}}}^{p} \overline{v}(\varphi, p') \, dp' 
$$


It’s conventional to set the streamfunction to zero at the top of the atmosphere:

$$
\Psi(\varphi, p_{\text{top}}) = 0
$$

Then $\Psi(\varphi, p) - \Psi(\varphi, p_{\text{top}})
= \frac{2\pi a \cos\varphi}{g} \int_{p_{\text{top}}}^{p} \overline{v}(\varphi, p') \, dp'$ becomes:

$$
\boxed{
\Psi(\varphi, p) = \frac{2\pi a \cos\varphi}{g} \int_{p_{\text{top}}}^{p} \overline{v}(\varphi, p') \, dp'
} 
$$
















<p><strong>Next</strong>: <a href="#">To be continued</a></p>


<div class="footer">
  Qi-fan based on the course material by Markus Jochum & Marta Mrozowska <br>
  It is very much a work in progress! Have you spotted a mistake or an error on this page? 
  Click <a href="mailto:qifan.wu@nbi.ku.dk">here</a> to tell me!<br>
  &copy; 2025 TeamOcean | NBI/KU
</div>
</div>

<script>
  function copyToClipboard(btn) {
    const code = btn.nextElementSibling.innerText;
    navigator.clipboard.writeText(code).then(() => {
      btn.classList.add('copied');
      setTimeout(() => btn.classList.remove('copied'), 2000);
    });
  }
</script>
</body>
</html>